--- 
title: "R을 이용한 퀀트 투자 포트폴리오 만들기"
author: "이현열"
date: "2020-09-27"
output:
  bookdown::gitbook:
    includes:
      after_body: disqus.html
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, article.bib]
biblio-style: apalike
link-citations: yes
github-repo: hyunyulhenry/quant_cookbook
---

# Welcome {-}

<img src="images/cover.png" width="70%" style="display: block; margin: auto;" />

[R을 이용한 퀀트 투자 포트폴리오 만들기 구매 링크](https://book.naver.com/bookdb/book_detail.nhn?bid=15369836)

본 페이지는 **R을 이용한 퀀트 투자 포트폴리오 만들기**의 웹사이트 입니다. 책의 수정 사항이 있을시 즉시 반영할 예정이며, 책에서 다루지 못했던 추가적인 내용도 지속적으로 업데이트 할 예정입니다.

<div style="background-color:#F7F7F7;padding: 20px 20px 20px 20px">

**패스트캠퍼스에서 본 책의 내용을 바탕으로 강의가 진행중이니, 수강을 원하시는 분은 참조하시기 바랍니다. [강의 링크](https://bit.ly/2WMwLpF)**

책 발간 이후 업데이트 내용은 다음과 같습니다.

- 2020년 9월 26일: 5장 [한국거래소의 산업별 현황 및 개별지표 크롤링] 부분이 R 4.0 이상 버젼에서 잘 작동하지 않는 문제가 발생하고 있습니다. R 3.6 버젼에서 실행해주시길 바랍니다. (https://rstudio.cloud/ 에서는 원하는 R 버젼으로 프로그램 실행이 가능합니다.) 해당 버젼에서도 안될 경우 session을 재시작하면 제대로 실행이 됩니다.

- 2020년 9월 26일: 4장 [기업공시채널에서 오늘의 공시 불러오기]에서 POST 부분의 url이 기존 **http**://kind.krx.co.kr/disclosure/todaydisclosure.do 에서 **https**://kind.krx.co.kr/disclosure/todaydisclosure.do 로 변경되었습니다. (http -> https)

- 2020년 4월 27일: 9장 [금융 데이터 수집하기 (심화)]에 [DART의 Open API를 이용한 데이터 수집하기] 챕터를 추가하였습니다. 이를 통해 더욱 다양한 데이터를 수집할 수 있습니다.

- 2020년 4월 7일: 각 페이지 하단에 질문/답변 기능을 추가하였습니다. 이제 블로그나 이메일, SNS 보다는 웹북에 질문을 남겨주시기 바랍니다.

- 2020년 3월 22일: 11장 [포트폴리오 구성]에 실무에서 많이 사용되는 인덱스 포트폴리오 및 인헨스드 인덱스 포트폴리오 구성 방법을 추가하였습니다.

- 2020년 3월 22일: 8장 [데이터 분석 및 시각화하기]에서 종목정보 시각화 이전에  `ggplot() 기초` 챕터를 추가하였습니다. 이로써 기존에 해당 패키지를 모르던 분도 쉽게 배울수 있도록 하였습니다.

- 2020년 3월 16일: 9장 [퀀트 전략을 이용한 종목선정 (기본)]과 10장 [퀀트 전략을 이용한 종목선정 (심화)]에서 재무제표를 이용한 전략의 경우, 1~4월에는 최근년도 데이터가 일부 종목에 대해서만 들어옵니다. 따라서 해당 기간에는 전전년도 데이터를 사용해야 하며, 이를 고려하도록 코드를 변경하였습니다.

- 2020년 3월 15일: 6장 [금융 데이터 수집하기 (심화)]에 [재무제표 및 가치지표 크롤링]에서 사용하는 페이지가 크롤러의 접근을 막음에 따라, `user_agent()` 를 이용하여 웹브라우저 인자를 추가해 주었습니다.

- 2020년 1월 19일: 5장의 [거래소 데이터 정리하기] 부분에서 `substr()` 함수 대신 stringr 패키지의 `str_sub()` 함수를 사용하여 코드를 훨씬 간결하게 표현했습니다. 또한 종목코드 끝이 0이 아닐 경우 우선주인 점을 이용하여 더욱 쉽게 클렌징 처리를 하였습니다.

- 2020년 1월 18일: 야후 파이낸스 웹페이지의 구조가 바뀌어 동적 크롤링을 통해서만 데이터 수집이 가능하게 되었습니다. 이는 본 책에서는 다루지 않으므로, 6장 [금융 데이터 수집하기 (심화)]에서 해당 부분을 삭제하였습니다.
</div>

## 지은이 소개 {-}

이현열

한양대학교에서 경영학을 전공하고, 카이스트 대학원에서 금융공학 석사 학위를 받았다. 졸업 후 증권사에서 주식운용을, 자산운용사에서 퀀트 포트폴리오 매니저 업무를 거쳐 현재는 보험사에서 데이터 분석 업무를 하고 있으며, 평소 꾸준한 SNS와 블로그 활동으로 퀀트 아이디어 및 백테스트 결과 등을 공유하면서 퀀트 투자의 대중화를 위해 노력하고 있다. 현재 한양대학교 재무금융 박사 과정에 재학 중이며, 패스트캠퍼스에서 R과 퀀트 투자 강의를 맡고 있다. 지은 책으로는 《스마트베타》(2017)가 있다.

## 머리말 {-}

퀀트 투자 중 팩터에 관한 이론적 내용을 다룬 [《SMART BETA(스마트 베타): 감정을 이기는 퀀트 투자》(김병규, 이현열, 워터베어프레스, 2017)](http://www.yes24.com/Product/Goods/56018775?Acode=101) 출간 이후 강의와 세미나를 통해많은 분들을 만났고, 공통적인 어려움을 느낄 수 있었습니다. 기관 투자자들이 손쉽게 데이터를 구할 수 있는 것과는 다르게, 일반 투자자들은 퀀트 투자를 하기 위한 데이터를 구하는 시작점부터 어려움을 겪는다는 것이었습니다.

이러한 문제로 어려움을 겪고 있는 분들에게 도움을 드리고자 HenryQuant 패키지를 만들어 배포했습니다. HenryQuant 패키지는 투자에 필요한 각종 데이터를 크롤링하여 수집하는 패키지로, 다행히 많은 분이 애용해주시고 있습니다.

이처럼 프로그래밍을 이용하면 일반 투자자들도 얼마든지 금융 데이터 수집 및 처리, 퀀트 모델 개발, 포트폴리오 분석 및 자동화 등이 가능합니다. 이 책을 읽는 독자분들이 스스로 이러한 퀀트 투자 프로세스를 만들 수 있기를 바라는 마음으로 책을 구성했습니다. 또한 실제 전문 투자자들이 사용하는 기술들도 포함했으니 책의 내용을 넘어 더욱 훌륭한 모델을 만드는 데 도움이 되길 기원합니다.

2019년 8월

이현열(leebisu@gmail.com)

## 이 책의 구성 {-}

이 책은 API와 크롤링을 통한 금융 데이터 수집, 투자 종목 선택 및 포트폴리오 구성, 백테스트와 성과 분석으로 이루어져 있습니다.

**CHAPTER 1 퀀트 투자의 심장: 데이터와 프로그래밍**
퀀트 투자란 무엇인지, 왜 프로그래밍이 필요한지, 여러 언어 중 R을 사용해야 하는 이유에 대해 살펴봅니다.

**CHAPTER 2 크롤링을 위한 기본 지식**
크롤링을 통한 데이터 수집에 앞서 인코딩, 웹의 동작 방식, HTML에 대한 기본 정보와 데이터 처리에 편리한 R 코드를 살펴봅니다.

**CHAPTER 3 API를 이용한 데이터 수집**
API를 통한 데이터 수집과 `getSymbols()` 함수의 사용 방법에 대해 살펴봅니다.

**CHAPTER 4 크롤링 이해하기**
크롤링이 무엇인가에 대해 살펴보며, GET과 POST 방식을 이용한 간단한 예제를 살펴봅니다.

**CHAPTER 5 금융 데이터 수집하기 기본**
한국거래소에서 제공하는 데이터를 크롤링하는 방법, 섹터의 구성종목을 수집하는 방법에 대해 살펴봅니다.

**CHAPTER 6 금융 데이터 수집하기 심화**
퀀트 투자의 핵심 자료인 수정주가, 재무제표 및 가치지표를 크롤링하는 방법을 살펴봅니다.

**CHAPTER 7 데이터 정리하기** 
앞에서 수집한 주가, 재무제표, 가치지표를 하나의 파일로 정리하는 방법을 살펴봅니다.

**CHAPTER 8 데이터 분석 및 시각화하기** 
수집한 데이터를 바탕으로 dplyr 패키지를 이용한 데이터 분석 및 ggplot2 패키지를 이용한 데이터 시각화, 인터랙티브 그래프를 나타내는 방법을 살펴봅니다.

**CHAPTER 9 퀀트 전략을 이용한 종목 선정 기본** 
베타에 대한 이해 및 기본적 팩터인 저변동성, 모멘텀, 밸류, 퀄리티를 이용한 종목 선정에 대해 살펴봅니다.

**CHAPTER 10 퀀트 전략을 이용한 종목 선정 심화** 
단순 종목 선정을 넘어 실무에서 사용되는 섹터 중립 포트폴리오 및 이상치 제거와 팩터 결합 방법, 마법공식 및 멀티팩터에 대해 살펴봅니다.

**CHAPTER 11 포트폴리오 구성** 
최적화 패키지를 이용한 포트폴리오 구성에서 가장 대중적으로 사용되는 최소분산 포트폴리오, 최대분산효과 포트폴리오, 위험균형 포트폴리오를 구현합니다.

**CHAPTER 12 포트폴리오 백테스트**
`Return.portfolio()` 함수를 이용한 백테스트 방법에 대해 살펴보겠습니다.

**CHAPTER 13 성과 및 위험 평가**
포트폴리오의 수익률을 바탕으로 성과 및 위험 평가에 사용되는 각종 지표에 대해 알아보며, 4팩터 회귀분석을 통한 요인 분석을 실행합니다.

## 이 책에서 다루지 않은 주제 {-}

이 책은 R을 기본적으로 사용할 줄 아는 독자를 대상으로 작성되었습니다. 따라서 내용의 효율적 전달을 위해 R과 R Studio 설치, 기초적인 프로그래밍 등의 내용은 생략했습니다. 따라서 프로그래밍을 처음 접하는 독자라면 프로그래밍 기초를 먼저 익히신후 본 책을 읽으시길 추천드립니다.

또한 텔레그램 메신저 자동전송, 이메일 자동전송, 전자공시시스템(DART) 크롤링, R마크다운과 샤이니를 이용한 포트폴리오 수익률 관리 등에 대한 주제는 다루지 않았습니다. 해당 내용은 저자의 블로그에 이미 업로드되어 있으므로 궁금한 분은 해당 글들을 참조하길 바라며, 기회가 된다면 추후 개정판에서 다루도록 하겠습니다.

마지막으로 이 책에서는 프로그램 언어로 R을 이용했기 때문에 Python 혹은 다른 언어를 사용하는 분들에게는 직접적으로 도움이 되지 않을 수 있다고 생각할 수 있습니다. 그러나 투자에 필요한 금융 데이터 수집을 어디서 어떻게 하는지, 종목 선택을 어떻게 하고 포트폴리오를 어떻게 구성하는지에 대한 이론적 내용을 이해한 후 본인들
이 사용하는 언어로 구현해보는 것도 좋은 도전이 될 것입니다.

## 도움이 될 만한 자료들 {-}

먼저 팩터 투자와 관련하여 심화된 내용을 알고 싶은 분은 저의 이전 책 및 책에서 인용된 논문을 읽어볼 것을 권합니다. R 프로그래밍과 관련하여 기초부터 tidyverse 패키지까지 이해하는 데 도움이 될만한 책 목록은 다음과 같습니다.

- [《SMART BETA(스마트 베타): 감정을 이기는 퀀트 투자》(김병규, 이현열, 워터베어프레스, 2017)](http://www.yes24.com/Product/Goods/56018775?Acode=101)
- 《손에 잡히는 R 프로그래밍》(가렛 그롤먼드, 한빛미디어, 2015)
- 《R Cookbook》(폴 티터, 인사이트, 2012)
- 《R을 활용한 데이터 과학》(해들리 위컴, 개럿 그롤문드, 인사이트, 2019)
- 《Do it! 쉽게 배우는 R 데이터 분석》(김영우, 이지스퍼블리싱, 2017)
- 《ggplot2: R로 분석한 데이터를 멋진 그래픽으로》(해들리 위컴, 프리렉, 2017)

## 이 책의 지원 페이지 {-}
 
이 책은 R의 bookdown 패키지로 작성되어 웹페이지 및 GitHub 저장소에 공유되어 있습니다. 따라서 책에 포함되어 있는 각종 코드를 웹페이지에 방문하여 얻으실 수 있습니다.

- 웹페이지: https://hyunyulhenry.github.io/quant_cookbook
- GitHub 저장소: https://github.com/hyunyulhenry/quant_cookbook


크롤링 대상 웹페이지의 구조가 바뀌어 코드의 수정이 필요할 경우 즉각적으로 반영할 것이며, 인쇄본에서 다루지 않은 내용도 추가적으로 업데이트될 예정입니다. 또한 bookdown 패키지를 이용하여 책을 집필하고자 하는 분들에게도 많은 도움이 될 것입
니다.

이 외에도 퀀트 투자 혹은 R을 이용한 투자 활용법 등의 내용은 저자의 블로그에 많은글들이 있으니 참조하기 바랍니다.

- Henry’s Quantopia: http://henryquant.blogspot.com

## 종목과 관련된 유의사항 {-}

팩터 모델을 이용한 종목 선택과 관련된 CHAPTER에서는 해당 조건으로 선택된 종목들이 나열되어 있습니다. 그러나 이는 **해당 종목에 대한 매수 추천이 아님을 밝히며, 데이터를 받은 시점의 종목이기에 독자 여러분이 책을 읽는 시점에서 선택된 종목과는 상당한 차이가 있습니다.**

또한 이 책에서 다루는 모델을 이용하여 투자를 할 경우, 이로 인한 이익과 손해는 본인에게 귀속됨을 알립니다.

## 세션정보 {-}

본 책에서 사용된 R 버젼 및 각종 정보는 다음과 같습니다.


```
## R version 3.6.3 (2020-02-29)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 16.04.6 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/atlas-base/atlas/libblas.so.3.0
## LAPACK: /usr/lib/atlas-base/atlas/liblapack.so.3.0
## 
## locale:
##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C          
##  [3] LC_TIME=C.UTF-8        LC_COLLATE=C.UTF-8    
##  [5] LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
##  [7] LC_PAPER=C.UTF-8       LC_NAME=C             
##  [9] LC_ADDRESS=C           LC_TELEPHONE=C        
## [11] LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets 
## [6] methods   base     
## 
## other attached packages:
## [1] showtext_0.9   showtextdb_3.0 sysfonts_0.8.1
## 
## loaded via a namespace (and not attached):
##  [1] compiler_3.6.3  magrittr_1.5    bookdown_0.20  
##  [4] htmltools_0.5.0 tools_3.6.3     yaml_2.2.1     
##  [7] stringi_1.5.3   rmarkdown_2.3   knitr_1.30     
## [10] stringr_1.4.0   digest_0.6.25   xfun_0.17      
## [13] rlang_0.4.7     evaluate_0.14
```

